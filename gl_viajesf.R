#libraries
library(readr)
library(dplyr)
#input

per <- c("01 - PRE NOCTURNO",
         "02 - NOCTURNO",
         "03 - TRANSICION NOCTURNO",
         "04 - PUNTA MANANA",
         "05 - TRANSICION PUNTA MANANA",
         "06 - FUERA DE PUNTA MANANA",
         "07 - PUNTA MEDIODIA",
         "08 - FUERA DE PUNTA TARDE",
         "09 - PUNTA TARDE",
         "10 - TRANSICION PUNTA TARDE",
         "11 - FUERA DE PUNTA NOCTURNO",
         "12 - PRE NOCTURNO")

dicc_nodo <- readr::read_csv2(file = "dicc_nodoV2.csv", locale = locale(encoding = "latin1"))
dicc_submodo <- readr::read_csv2(file = "dicc_submodoV3.csv", locale = locale(encoding = "latin1"), 
                                 col_types = cols(Servicio = col_character(), CategorÃ­a = col_character(),
                                                  `CategorÃ­a dos` = col_character()))

query <- list()
for (i in 1:length(per)){
query[[i]] <- paste0("SELECT SUM(CAST(factorexpansion AS FLOAT))/5 AS Dda, 
paraderosubida, paraderobajada, netapa, tipotransporte_1era,	tipotransporte_2da, tipotransporte_3era,	
tipotransporte_4ta,	serv_1era_etapa,	serv_2da_etapa,	serv_3era_etapa, serv_4ta_etapa,	
linea_metro_subida_1,	linea_metro_subida_2,	linea_metro_subida_3,	linea_metro_subida_4,	
linea_metro_bajada_1,	linea_metro_bajada_2,	linea_metro_bajada_3,	linea_metro_bajada_4,	
paraderosubida_1era,	paraderosubida_2da,	paraderosubida_3era,	paraderosubida_4ta,	
paraderobajada_1era,	paraderobajada_2da,	paraderobajada_3era,	paraderobajada_4ta
FROM [uchile].[dbo].[viajes201804_laboral_transparencia]
WHERE periodomediodeviaje = '", per[i], "' AND paraderosubida <> '-' AND 
paraderobajada <> '-' AND factorexpansion <> '-'
GROUP BY  netapa, periodomediodeviaje, paraderosubida, paraderobajada, tipotransporte_1era,	
tipotransporte_2da, tipotransporte_3era,	tipotransporte_4ta,	serv_1era_etapa,	serv_2da_etapa,	
serv_3era_etapa, serv_4ta_etapa,	linea_metro_subida_1,	linea_metro_subida_2,	
linea_metro_subida_3,	linea_metro_subida_4,	linea_metro_bajada_1,	linea_metro_bajada_2,	
linea_metro_bajada_3,	linea_metro_bajada_4,	paraderosubida_1era,	paraderosubida_2da,	
paraderosubida_3era,	paraderosubida_4ta,	paraderobajada_1era,	paraderobajada_2da,	
paraderobajada_3era,	paraderobajada_4ta;")  
}

#travel file for each period
vjs_per <- list()
for(i in 1:length(query)){
vjs_per[[i]] <- viajes(query = query[i], dicc_nd = dicc_nodo, dicc_m2 = dicc_submodo, per = per[i]) 
}

#unite files in the directory and save
list.files(path = "output viajes_etapas/", pattern = "^baseviajes", full.names = T) %>% 
  purrr::map_dfr(~readr::read_delim(., delim = ";")) %>% 
   readr::write_delim(path = "output viajes_etapas/baseviajesDLN2.csv", delim = ";")
rm(vjs_per)

viajes <- function(query, dicc_nd, dicc_m2, per){
  #libraries
  library(RODBC)
  library(ff)
  library(ETLUtils)
  library(dplyr)
  library(tidyr)
  library(sqldf)
  library(readxl)
  library(expss)
  
  datos <- as.data.frame(read.odbc.ffdf(odbcConnect.args = list("uchile", uid = "sa", 
                                                                pwd = "Estudios2017.."), VERBOSE = T, query = query))
  #factor to character
  i <- sapply(datos, is.factor)
  datos[i] <- lapply(datos[i], as.character)
  #correct service in each trip
  datos <- dplyr::mutate(datos, paraderosubida_1era = replace(paraderosubida_1era, 
                                                              which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L1", "L1-L5") & 
                                                                      paraderosubida_1era == "BAQUEDANO"), "BAQUEDANO L1"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                          which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L1", "L1-L2") & 
                                                                                                                                                                  paraderosubida_1era == "LOS HEROES"), "LOS HEROES L1"), paraderosubida_1era = replace(paraderosubida_1era, which(tipotransporte_1era == "METRO" &
                                                                                                                                                                                                                                                                                     linea_metro_subida_1 %in% c("L1", "L1-L2") & paraderosubida_1era == "LOS LEONES"), "LOS LEONES L1"),
                         paraderosubida_1era = replace(paraderosubida_1era, which(tipotransporte_1era == "METRO" & 
                                                                                    linea_metro_subida_1 %in% c("L1", "L1-L4") & paraderosubida_1era == "TOBALABA"), "TOBALABA L1"),
                         paraderosubida_1era = replace(paraderosubida_1era, which(tipotransporte_1era == "METRO" &
                                                                                    linea_metro_subida_1 %in% c("L1", "L1-L3") & paraderosubida_1era == "UNIVERSIDAD DE CHILE"), 
                                                       "UNIVERSIDAD DE CHILE L1"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                 which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L2", "L2-L3") & 
                                                                                                                         paraderosubida_1era == "CAL Y CANTO"), "CAL Y CANTO L2"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                 which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L2", "L2-L6") & 
                                                                                                                                                                                                                         paraderosubida_1era == "FRANKLIN"), "FRANKLIN L2"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                           which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L2", "L2-L4A") & 
                                                                                                                                                                                                                                                                                                                   paraderosubida_1era == "LA CISTERNA"), "LA CISTERNA L2"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                           which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L2", "L2-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                   paraderosubida_1era == "LOS HEROES"), "LOS HEROES L2"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L2", "L2-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderosubida_1era == "SANTA ANA"), "SANTA ANA L2"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L4", "L4-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             paraderosubida_1era == "PLAZA EGANA"), "PLAZA EGANA L4"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L4", "L4-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             paraderosubida_1era == "TOBALABA"), "TOBALABA L4"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L4", "L4-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       paraderosubida_1era == "VICENTE VALDES"), "VICENTE VALDES L4"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L4", "L4-L4A") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             paraderosubida_1era == "VICUNA MACKENNA"), "VICUNA MACKENNA L4"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L5", "L5-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     paraderosubida_1era == "BAQUEDANO"), "BAQUEDANO L5"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderosubida_1era == "IRARRAZAVAL"), "IRARRAZAVAL L5"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L5", "L5-L6") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderosubida_1era == "NUBLE"), "NUBLE L5"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     paraderosubida_1era == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L5"),paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L6", "L6-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          paraderosubida_1era == "FRANKLIN"), "FRANKLIN L6"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L6", "L6-MT") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    paraderosubida_1era == "LO VALLEDOR"), "LO VALLEDOR L6"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L6", "L6-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    paraderosubida_1era == "NUBLE"), "NUBLE L6"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L6", "L6-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        paraderosubida_1era == "NUNOA"), "NUNOA L6"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L3", "L3-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            paraderosubida_1era == "CAL Y CANTO"), "CAL Y CANTO L3"),paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L3", "L3-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           paraderosubida_1era == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L3"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L3", "L3-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderosubida_1era == "UNIVERSIDAD DE CHILE"), "UNIVERSIDAD DE CHILE L3"), paraderosubida_1era = 
                           replace(paraderosubida_1era, which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% 
                                                                c("L3", "L3-L5") & paraderosubida_1era == "IRARRAZAVAL"), "IRARRAZAVAL L3"), paraderosubida_1era = 
                           replace(paraderosubida_1era, which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% 
                                                                c("L3", "L3-L6") & paraderosubida_1era == "NUNOA"), "NUNOA L3"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                               which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L3", "L3-L4") & 
                                                                                                                                                                       paraderosubida_1era == "PLAZA EGANA"), "PLAZA EGANA L3"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                              which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L1", "L1-L5") & 
                                                                                                                                                                                                                                                                      paraderosubida_2da == "BAQUEDANO"), "BAQUEDANO L1"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                        which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L1", "L1-L2") & 
                                                                                                                                                                                                                                                                                                                                                                paraderosubida_2da == "LOS HEROES"), "LOS HEROES L1"), paraderosubida_2da = replace(paraderosubida_2da, which(tipotransporte_2da == "METRO" &
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                linea_metro_subida_2 %in% c("L1", "L1-L2") & paraderosubida_2da == "LOS LEONES"), "LOS LEONES L1"),
                         paraderosubida_2da = replace(paraderosubida_2da, which(tipotransporte_2da == "METRO" & 
                                                                                  linea_metro_subida_2 %in% c("L1", "L1-L4") & paraderosubida_2da == "TOBALABA"), "TOBALABA L1"),
                         paraderosubida_2da = replace(paraderosubida_2da, which(tipotransporte_2da == "METRO" &
                                                                                  linea_metro_subida_2 %in% c("L1", "L1-L3") & paraderosubida_2da == "UNIVERSIDAD DE CHILE"), 
                                                      "UNIVERSIDAD DE CHILE L1"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                               which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L2", "L2-L3") & 
                                                                                                                       paraderosubida_2da == "CAL Y CANTO"), "CAL Y CANTO L2"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                             which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L2", "L2-L6") & 
                                                                                                                                                                                                                     paraderosubida_2da == "FRANKLIN"), "FRANKLIN L2"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                     which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L2", "L2-L4A") & 
                                                                                                                                                                                                                                                                                                             paraderosubida_2da == "LA CISTERNA"), "LA CISTERNA L2"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L2", "L2-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                           paraderosubida_2da == "LOS HEROES"), "LOS HEROES L2"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L2", "L2-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       paraderosubida_2da == "SANTA ANA"), "SANTA ANA L2"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L4", "L4-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderosubida_2da == "PLAZA EGANA"), "PLAZA EGANA L4"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L4", "L4-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               paraderosubida_2da == "TOBALABA"), "TOBALABA L4"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L4", "L4-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       paraderosubida_2da == "VICENTE VALDES"), "VICENTE VALDES L4"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L4", "L4-L4A") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           paraderosubida_2da == "VICUNA MACKENNA"), "VICUNA MACKENNA L4"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L5", "L5-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderosubida_2da == "BAQUEDANO"), "BAQUEDANO L5"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           paraderosubida_2da == "IRARRAZAVAL"), "IRARRAZAVAL L5"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L5", "L5-L6") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         paraderosubida_2da == "NUBLE"), "NUBLE L5"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           paraderosubida == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L5"),paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L6", "L6-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          paraderosubida_2da == "FRANKLIN"), "FRANKLIN L6"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L6", "L6-MT") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  paraderosubida_2da == "LO VALLEDOR"), "LO VALLEDOR L6"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L6", "L6-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                paraderosubida_2da == "NUBLE"), "NUBLE L6"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L6", "L6-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  paraderosubida_2da == "NUNOA"), "NUNOA L6"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L3", "L3-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    paraderosubida_2da == "CAL Y CANTO"), "CAL Y CANTO L3"),paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L3", "L3-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderosubida_2da == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L3"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L3", "L3-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     paraderosubida_2da == "UNIVERSIDAD DE CHILE"), "UNIVERSIDAD DE CHILE L3"), paraderosubida_2da = 
                           replace(paraderosubida_2da, which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% 
                                                               c("L3", "L3-L5") & paraderosubida_2da == "IRARRAZAVAL"), "IRARRAZAVAL L3"), paraderosubida_2da = 
                           replace(paraderosubida_2da, which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% 
                                                               c("L3", "L3-L6") & paraderosubida_2da == "NUNOA"), "NUNOA L3"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                            which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L3", "L3-L4") & 
                                                                                                                                                                    paraderosubida_2da == "PLAZA EGANA"), "PLAZA EGANA L3"),
                         paraderosubida_3era = replace(paraderosubida_3era, which(tipotransporte_3era == "METRO" & 
                                                                                    linea_metro_subida_3 %in% c("L1", "L1-L5") & paraderosubida_3era == "BAQUEDANO"), "BAQUEDANO L1"), 
                         paraderosubida_3era = replace(paraderosubida_3era, which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L1", "L1-L2") & 
                                                                                    paraderosubida_3era == "LOS HEROES"), "LOS HEROES L1"), paraderosubida_3era = replace(paraderosubida_3era, which(tipotransporte_3era == "METRO" &
                                                                                                                                                                                                       linea_metro_subida_3 %in% c("L1", "L1-L2") & paraderosubida_3era == "LOS LEONES"), "LOS LEONES L1"),
                         paraderosubida_3era = replace(paraderosubida_3era, which(tipotransporte_3era == "METRO" & 
                                                                                    linea_metro_subida_3 %in% c("L1", "L1-L4") & paraderosubida_3era == "TOBALABA"), "TOBALABA L1"),
                         paraderosubida_3era = replace(paraderosubida_3era, which(tipotransporte_3era == "METRO" &
                                                                                    linea_metro_subida_3 %in% c("L1", "L1-L3") & paraderosubida_3era == "UNIVERSIDAD DE CHILE"), 
                                                       "UNIVERSIDAD DE CHILE L1"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                 which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L2", "L2-L3") & 
                                                                                                                         paraderosubida_3era == "CAL Y CANTO"), "CAL Y CANTO L2"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                 which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L2", "L2-L6") & 
                                                                                                                                                                                                                         paraderosubida_3era == "FRANKLIN"), "FRANKLIN L2"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                           which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L2", "L2-L4A") & 
                                                                                                                                                                                                                                                                                                                   paraderosubida_3era == "LA CISTERNA"), "LA CISTERNA L2"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                           which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L2", "L2-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                   paraderosubida_3era == "LOS HEROES"), "LOS HEROES L2"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L2", "L2-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderosubida_3era == "SANTA ANA"), "SANTA ANA L2"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L4", "L4-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             paraderosubida_3era == "PLAZA EGANA"), "PLAZA EGANA L4"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L4", "L4-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             paraderosubida_3era == "TOBALABA"), "TOBALABA L4"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L4", "L4-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       paraderosubida_3era == "VICENTE VALDES"), "VICENTE VALDES L4"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L4", "L4-L4A") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             paraderosubida_3era == "VICUNA MACKENNA"), "VICUNA MACKENNA L4"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L5", "L5-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     paraderosubida_3era == "BAQUEDANO"), "BAQUEDANO L5"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderosubida_3era == "IRARRAZAVAL"), "IRARRAZAVAL L5"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L5", "L5-L6") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderosubida_3era == "NUBLE"), "NUBLE L5"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L6", "L6-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     paraderosubida_3era == "FRANKLIN"), "FRANKLIN L6"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L6", "L6-MT") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               paraderosubida_3era == "LO VALLEDOR"), "LO VALLEDOR L6"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L6", "L6-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               paraderosubida_3era == "NUBLE"), "NUBLE L6"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   paraderosubida_3era == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L5"),paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L6", "L6-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        paraderosubida_3era == "NUNOA"), "NUNOA L6"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L3", "L3-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            paraderosubida_3era == "CAL Y CANTO"), "CAL Y CANTO L3"),paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L3", "L3-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           paraderosubida_3era == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L3"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L3", "L3-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderosubida_3era == "UNIVERSIDAD DE CHILE"), "UNIVERSIDAD DE CHILE L3"), paraderosubida_3era = 
                           replace(paraderosubida_3era, which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% 
                                                                c("L3", "L3-L5") & paraderosubida_3era == "IRARRAZAVAL"), "IRARRAZAVAL L3"), paraderosubida_3era = 
                           replace(paraderosubida_3era, which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% 
                                                                c("L3", "L3-L6") & paraderosubida_3era == "NUNOA"), "NUNOA L3"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                                                                               which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L3", "L3-L4") & 
                                                                                                                                                                       paraderosubida_3era == "PLAZA EGANA"), "PLAZA EGANA L3"),
                         paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                      which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L1", "L1-L5") & 
                                                              paraderosubida_4ta == "BAQUEDANO"), "BAQUEDANO L1"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L1", "L1-L2") & 
                                                                                                                                                        paraderosubida_4ta == "LOS HEROES"), "LOS HEROES L1"), paraderosubida_4ta = replace(paraderosubida_4ta, which(tipotransporte_4ta == "METRO" &
                                                                                                                                                                                                                                                                        linea_metro_subida_4 %in% c("L1", "L1-L2") & paraderosubida_4ta == "LOS LEONES"), "LOS LEONES L1"),
                         paraderosubida_4ta = replace(paraderosubida_4ta, which(tipotransporte_4ta == "METRO" & 
                                                                                  linea_metro_subida_4 %in% c("L1", "L1-L4") & paraderosubida_4ta == "TOBALABA"), "TOBALABA L1"),
                         paraderosubida_4ta = replace(paraderosubida_4ta, which(tipotransporte_4ta == "METRO" &
                                                                                  linea_metro_subida_4 %in% c("L1", "L1-L3") & paraderosubida_4ta == "UNIVERSIDAD DE CHILE"), 
                                                      "UNIVERSIDAD DE CHILE L1"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                               which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L2", "L2-L3") & 
                                                                                                                       paraderosubida_4ta == "CAL Y CANTO"), "CAL Y CANTO L2"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                             which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L2", "L2-L6") & 
                                                                                                                                                                                                                     paraderosubida_4ta == "FRANKLIN"), "FRANKLIN L2"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                     which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L2", "L2-L4A") & 
                                                                                                                                                                                                                                                                                                             paraderosubida_4ta == "LA CISTERNA"), "LA CISTERNA L2"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L2", "L2-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                           paraderosubida_4ta == "LOS HEROES"), "LOS HEROES L2"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L2", "L2-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       paraderosubida_4ta == "SANTA ANA"), "SANTA ANA L2"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L4", "L4-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderosubida_4ta == "PLAZA EGANA"), "PLAZA EGANA L4"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L4", "L4-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               paraderosubida_4ta == "TOBALABA"), "TOBALABA L4"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L4", "L4-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       paraderosubida_4ta == "VICENTE VALDES"), "VICENTE VALDES L4"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L4", "L4-L4A") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           paraderosubida_4ta == "VICUNA MACKENNA"), "VICUNA MACKENNA L4"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L5", "L5-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderosubida_4ta == "BAQUEDANO"), "BAQUEDANO L5"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           paraderosubida_4ta == "IRARRAZAVAL"), "IRARRAZAVAL L5"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L5", "L5-L6") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         paraderosubida_4ta == "NUBLE"), "NUBLE L5"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           paraderosubida_4ta == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L5"),paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L6", "L6-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              paraderosubida_4ta == "FRANKLIN"), "FRANKLIN L6"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L6", "L6-MT") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      paraderosubida_4ta == "LO VALLEDOR"), "LO VALLEDOR L6"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L6", "L6-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    paraderosubida_4ta == "NUBLE"), "NUBLE L6"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L6", "L6-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      paraderosubida_4ta == "NUNOA"), "NUNOA L6"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L3", "L3-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        paraderosubida_4ta == "CAL Y CANTO"), "CAL Y CANTO L3"),paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L3", "L3-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     paraderosubida_4ta == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L3"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L3", "L3-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         paraderosubida_4ta == "UNIVERSIDAD DE CHILE"), "UNIVERSIDAD DE CHILE L3"), paraderosubida_4ta = 
                           replace(paraderosubida_4ta, which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% 
                                                               c("L3", "L3-L5") & paraderosubida_4ta == "IRARRAZAVAL"), "IRARRAZAVAL L3"), paraderosubida_4ta = 
                           replace(paraderosubida_4ta, which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% 
                                                               c("L3", "L3-L6") & paraderosubida_4ta == "NUNOA"), "NUNOA L3"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                                                                            which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L3", "L3-L4") & 
                                                                                                                                                                    paraderosubida_4ta == "PLAZA EGANA"), "PLAZA EGANA L3"),
                         paraderobajada_1era = replace(paraderobajada_1era, which(tipotransporte_1era == "METRO" & 
                                                                                    linea_metro_bajada_1 %in% c("L1", "L1-L5") & paraderobajada_1era == "BAQUEDANO"), "BAQUEDANO L1"), 
                         paraderobajada_1era = replace(paraderobajada_1era, which(tipotransporte_1era == "METRO" & 
                                                                                    linea_metro_bajada_1 %in% c("L1", "L1-L2") & paraderobajada_1era == "LOS HEROES"), "LOS HEROES L1"), 
                         paraderobajada_1era = replace(paraderobajada_1era, which(tipotransporte_1era == "METRO" & 
                                                                                    linea_metro_bajada_1 %in% c("L1", "L1-L2") & paraderobajada_1era == "LOS LEONES"), "LOS LEONES L1"),
                         paraderobajada_1era = replace(paraderobajada_1era, which(tipotransporte_1era == "METRO" & 
                                                                                    linea_metro_bajada_1 %in% c("L1", "L1-L4") & paraderobajada_1era == "TOBALABA"), "TOBALABA L1"),
                         paraderobajada_1era = replace(paraderobajada_1era, which(tipotransporte_1era == "METRO" &
                                                                                    linea_metro_bajada_1 %in% c("L1", "L1-L3") & paraderobajada_1era == "UNIVERSIDAD DE CHILE"), 
                                                       "UNIVERSIDAD DE CHILE L1"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                 which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L2", "L2-L3") & 
                                                                                                                         paraderobajada_1era == "CAL Y CANTO"), "CAL Y CANTO L2"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                 which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L2", "L2-L6") & 
                                                                                                                                                                                                                         paraderobajada_1era == "FRANKLIN"), "FRANKLIN L2"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                           which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L2", "L2-L4A") & 
                                                                                                                                                                                                                                                                                                                   paraderobajada_1era == "LA CISTERNA"), "LA CISTERNA L2"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                           which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L2", "L2-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                   paraderobajada_1era == "LOS HEROES"), "LOS HEROES L2"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L2", "L2-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderobajada_1era == "SANTA ANA"), "SANTA ANA L2"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L4", "L4-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             paraderobajada_1era == "PLAZA EGANA"), "PLAZA EGANA L4"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L4", "L4-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             paraderobajada_1era == "TOBALABA"), "TOBALABA L4"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L4", "L4-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       paraderobajada_1era == "VICENTE VALDES"), "VICENTE VALDES L4"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L4", "L4-L4A") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             paraderobajada_1era == "VICUNA MACKENNA"), "VICUNA MACKENNA L4"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L5", "L5-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     paraderobajada_1era == "BAQUEDANO"), "BAQUEDANO L5"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderobajada_1era == "IRARRAZAVAL"), "IRARRAZAVAL L5"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L5", "L5-L6") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderobajada_1era == "NUBLE"), "NUBLE L5"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     paraderobajada_1era == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L5"),paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L6", "L6-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          paraderobajada_1era == "FRANKLIN"), "FRANKLIN L6"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L6", "L6-MT") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    paraderobajada_1era == "LO VALLEDOR"), "LO VALLEDOR L6"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L6", "L6-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    paraderobajada_1era == "NUBLE"), "NUBLE L6"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L6", "L6-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        paraderobajada_1era == "NUNOA"), "NUNOA L6"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L3", "L3-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            paraderobajada_1era == "CAL Y CANTO"), "CAL Y CANTO L3"),paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L3", "L3-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           paraderobajada_1era == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L3"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L3", "L3-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderobajada_1era == "UNIVERSIDAD DE CHILE"), "UNIVERSIDAD DE CHILE L3"), paraderobajada_1era = 
                           replace(paraderobajada_1era, which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% 
                                                                c("L3", "L3-L5") & paraderobajada_1era == "IRARRAZAVAL"), "IRARRAZAVAL L3"), paraderobajada_1era = 
                           replace(paraderobajada_1era, which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% 
                                                                c("L3", "L3-L6") & paraderobajada_1era == "NUNOA"), "NUNOA L3"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                                                                               which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L3", "L3-L4") & 
                                                                                                                                                                       paraderobajada_1era == "PLAZA EGANA"), "PLAZA EGANA L3"),
                         paraderobajada_2da = replace(paraderobajada_2da, which(tipotransporte_2da == "METRO" &
                                                                                  linea_metro_bajada_2 %in% c("L1", "L1-L5") & paraderobajada_2da == "BAQUEDANO"), "BAQUEDANO L1"),
                         paraderobajada_2da = replace(paraderobajada_2da, which(tipotransporte_2da == "METRO" &
                                                                                  linea_metro_bajada_2 %in% c("L1", "L1-L5") & paraderobajada_2da == "SAN PABLO"), "SAN PABLO L1"),
                         paraderobajada_2da = replace(paraderobajada_2da, which(tipotransporte_2da == "METRO" &
                                                                                  linea_metro_bajada_2 %in% c("L1", "L1-L2") & paraderobajada_2da == "LOS HEROES"), "LOS HEROES L1"),
                         paraderobajada_2da = replace(paraderobajada_2da, which(tipotransporte_2da == "METRO" &
                                                                                  linea_metro_bajada_2 %in% c("L1", "L1-L2") & paraderobajada_2da == "LOS LEONES"), "LOS LEONES L1"),
                         paraderobajada_2da = replace(paraderobajada_2da, which(tipotransporte_2da == "METRO" &
                                                                                  linea_metro_bajada_2 %in% c("L1", "L1-L4") & paraderobajada_2da == "TOBALABA"), "TOBALABA L1"),
                         paraderobajada_2da = replace(paraderobajada_2da, which(tipotransporte_2da == "METRO" &
                                                                                  linea_metro_bajada_2 %in% c("L1", "L1-L3") & paraderobajada_2da == "UNIVERSIDAD DE CHILE"),
                                                      "UNIVERSIDAD DE CHILE L1"),
                         paraderobajada_2da = replace(paraderobajada_2da, which(tipotransporte_2da == "METRO" &
                                                                                  linea_metro_bajada_2 %in% c("L2", "L2-L3") &
                                                                                  paraderobajada_2da == "CAL Y CANTO"), "CAL Y CANTO L2"),
                         paraderobajada_2da = replace(paraderobajada_2da, which(tipotransporte_2da == "METRO" &
                                                                                  linea_metro_bajada_2 %in% c("L2", "L2-L6") &
                                                                                  paraderobajada_2da == "FRANKLIN"), "FRANKLIN L2"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                                  which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L2", "L2-L4A") &
                                                                                                                                                                          paraderobajada_2da == "LA CISTERNA"), "LA CISTERNA L2"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                                                                                                                                which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L2", "L2-L1") &
                                                                                                                                                                                                                                                                        paraderobajada_2da == "LOS HEROES"), "LOS HEROES L2"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                                                                                                                                                                                                                            which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L2", "L2-L5") &
                                                                                                                                                                                                                                                                                                                                                                    paraderobajada_2da == "SANTA ANA"), "SANTA ANA L2"),
                         paraderobajada_2da = replace(paraderobajada_2da,
                                                      which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L4", "L4-L3") &
                                                              paraderobajada_2da == "PLAZA EGANA"), "PLAZA EGANA L4"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                    which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L4", "L4-L1") &
                                                                                                                                                            paraderobajada_2da == "TOBALABA"), "TOBALABA L4"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                                                                                                            which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L4", "L4-L5") &
                                                                                                                                                                                                                                                    paraderobajada_2da == "VICENTE VALDES"), "VICENTE VALDES L4"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                                                                                                                                                                                                                which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L4", "L4-L4A") &
                                                                                                                                                                                                                                                                                                                                                        paraderobajada_2da == "VICUNA MACKENNA"), "VICUNA MACKENNA L4"),
                         paraderobajada_2da = replace(paraderobajada_2da,
                                                      which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L5", "L5-L1") &
                                                              paraderobajada_2da == "BAQUEDANO"), "BAQUEDANO L5"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L5", "L5-L3") &
                                                                                                                                                        paraderobajada_2da == "IRARRAZAVAL"), "IRARRAZAVAL L5"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                                                                                                              which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L5", "L5-L6") &
                                                                                                                                                                                                                                                      paraderobajada_2da == "NUBLE"), "NUBLE L5"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                                                                                                                                                                                                which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L5", "L5-L3") &
                                                                                                                                                                                                                                                                                                                                        paraderobajada_2da == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L5"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                                                                                                                                                                                                                                                                                                    which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L5", "L5-L1") &
                                                                                                                                                                                                                                                                                                                                                                                                                                            paraderobajada_2da == "SAN PABLO"), "SAN PABLO L5"),
                         paraderobajada_2da = replace(paraderobajada_2da,
                                                      which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L5", "L5-L2") &
                                                              paraderobajada_2da == "SANTA ANA"), "SANTA ANA L5"),
                         paraderobajada_2da = replace(paraderobajada_2da,
                                                      which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L6", "L6-L2") &
                                                              paraderobajada_2da == "FRANKLIN"), "FRANKLIN L6"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                              which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L6", "L6-MT") &
                                                                                                                                                      paraderobajada_2da == "LO VALLEDOR"), "LO VALLEDOR L6"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                                                                                                            which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L6", "L6-L5") &
                                                                                                                                                                                                                                                    paraderobajada_2da == "NUBLE"), "NUBLE L6"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                                                                                                                                                                                              which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L6", "L6-L3") &
                                                                                                                                                                                                                                                                                                                                      paraderobajada_2da == "NUNOA"), "NUNOA L6"),
                         paraderobajada_2da = replace(paraderobajada_2da,
                                                      which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L3", "L3-L2") &
                                                              paraderobajada_2da == "CAL Y CANTO"), "CAL Y CANTO L3"),paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                   which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L3", "L3-L5") &
                                                                                                                                                           paraderobajada_2da == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L3"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                                                                                                                       which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L3", "L3-L1") &
                                                                                                                                                                                                                                                               paraderobajada_2da == "UNIVERSIDAD DE CHILE"), "UNIVERSIDAD DE CHILE L3"), paraderobajada_2da =
                           replace(paraderobajada_2da, which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in%
                                                               c("L3", "L3-L5") & paraderobajada_2da == "IRARRAZAVAL"), "IRARRAZAVAL L3"), paraderobajada_2da =
                           replace(paraderobajada_2da, which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in%
                                                               c("L3", "L3-L6") & paraderobajada_2da == "NUNOA"), "NUNOA L3"), paraderobajada_2da = replace(paraderobajada_2da,
                                                                                                                                                            which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L3", "L3-L4") &
                                                                                                                                                                    paraderobajada_2da == "PLAZA EGANA"), "PLAZA EGANA L3"),
                         
                         paraderobajada_3era = replace(paraderobajada_3era, which(tipotransporte_3era == "METRO" & 
                                                                                    linea_metro_bajada_3 %in% c("L1", "L1-L5") & paraderobajada_3era == "BAQUEDANO"), "BAQUEDANO L1"), 
                         paraderobajada_3era = replace(paraderobajada_3era, which(tipotransporte_3era == "METRO" & 
                                                                                    linea_metro_bajada_3 %in% c("L1", "L1-L2") & paraderobajada_3era == "LOS HEROES"), "LOS HEROES L1"), 
                         paraderobajada_3era = replace(paraderobajada_3era, which(tipotransporte_3era == "METRO" & 
                                                                                    linea_metro_bajada_3 %in% c("L1", "L1-L2") & paraderobajada_3era == "LOS LEONES"), "LOS LEONES L1"),
                         paraderobajada_3era = replace(paraderobajada_3era, which(tipotransporte_3era == "METRO" & 
                                                                                    linea_metro_bajada_3 %in% c("L1", "L1-L4") & paraderobajada_3era == "TOBALABA"), "TOBALABA L1"),
                         paraderobajada_3era = replace(paraderobajada_3era, which(tipotransporte_3era == "METRO" &
                                                                                    linea_metro_bajada_3 %in% c("L1", "L1-L3") & paraderobajada_3era == "UNIVERSIDAD DE CHILE"), 
                                                       "UNIVERSIDAD DE CHILE L1"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                 which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L2", "L2-L3") & 
                                                                                                                         paraderobajada_3era == "CAL Y CANTO"), "CAL Y CANTO L2"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                 which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L2", "L2-L6") & 
                                                                                                                                                                                                                         paraderobajada_3era == "FRANKLIN"), "FRANKLIN L2"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                           which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L2", "L2-L4A") & 
                                                                                                                                                                                                                                                                                                                   paraderobajada_3era == "LA CISTERNA"), "LA CISTERNA L2"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                           which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L2", "L2-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                   paraderobajada_3era == "LOS HEROES"), "LOS HEROES L2"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L2", "L2-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderobajada_3era == "SANTA ANA"), "SANTA ANA L2"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L4", "L4-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             paraderobajada_3era == "PLAZA EGANA"), "PLAZA EGANA L4"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L4", "L4-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             paraderobajada_3era == "TOBALABA"), "TOBALABA L4"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L4", "L4-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       paraderobajada_3era == "VICENTE VALDES"), "VICENTE VALDES L4"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L4", "L4-L4A") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             paraderobajada_3era == "VICUNA MACKENNA"), "VICUNA MACKENNA L4"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L5", "L5-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     paraderobajada_3era == "BAQUEDANO"), "BAQUEDANO L5"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderobajada_3era == "IRARRAZAVAL"), "IRARRAZAVAL L5"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L5", "L5-L6") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderobajada_3era == "NUBLE"), "NUBLE L5"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     paraderobajada_3era == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L5"),paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L6", "L6-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          paraderobajada_3era == "FRANKLIN"), "FRANKLIN L6"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L6", "L6-MT") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    paraderobajada_3era == "LO VALLEDOR"), "LO VALLEDOR L6"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L6", "L6-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    paraderobajada_3era == "NUBLE"), "NUBLE L6"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L6", "L6-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        paraderobajada_3era == "NUNOA"), "NUNOA L6"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L3", "L3-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            paraderobajada_3era == "CAL Y CANTO"), "CAL Y CANTO L3"),paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L3", "L3-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           paraderobajada_3era == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L3"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L3", "L3-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderobajada_3era == "UNIVERSIDAD DE CHILE"), "UNIVERSIDAD DE CHILE L3"), paraderobajada_3era = 
                           replace(paraderobajada_3era, which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% 
                                                                c("L3", "L3-L5") & paraderobajada_3era == "IRARRAZAVAL"), "IRARRAZAVAL L3"), paraderobajada_3era = 
                           replace(paraderobajada_3era, which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% 
                                                                c("L3", "L3-L6") & paraderobajada_3era == "NUNOA"), "NUNOA L3"), paraderobajada_3era = replace(paraderobajada_3era, 
                                                                                                                                                               which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L3", "L3-L4") & 
                                                                                                                                                                       paraderobajada_3era == "PLAZA EGANA"), "PLAZA EGANA L3"),
                         paraderobajada_4ta = replace(paraderobajada_4ta, which(tipotransporte_4ta == "METRO" & 
                                                                                  linea_metro_bajada_4 %in% c("L1", "L1-L5") & paraderobajada_4ta == "BAQUEDANO"), "BAQUEDANO L1"), 
                         paraderobajada_4ta = replace(paraderobajada_4ta, which(tipotransporte_4ta == "METRO" & 
                                                                                  linea_metro_bajada_4 %in% c("L1", "L1-L5") & paraderobajada_4ta == "SAN PABLO"), "SAN PABLO L1"), 
                         paraderobajada_4ta = replace(paraderobajada_4ta, which(tipotransporte_4ta == "METRO" & 
                                                                                  linea_metro_bajada_4 %in% c("L1", "L1-L2") & paraderobajada_4ta == "LOS HEROES"), "LOS HEROES L1"), 
                         paraderobajada_4ta = replace(paraderobajada_4ta, which(tipotransporte_4ta == "METRO" & 
                                                                                  linea_metro_bajada_4 %in% c("L1", "L1-L2") & paraderobajada_4ta == "LOS LEONES"), "LOS LEONES L1"),
                         paraderobajada_4ta = replace(paraderobajada_4ta, which(tipotransporte_4ta == "METRO" & 
                                                                                  linea_metro_bajada_4 %in% c("L1", "L1-L4") & paraderobajada_4ta == "TOBALABA"), "TOBALABA L1"),
                         paraderobajada_4ta = replace(paraderobajada_4ta, which(tipotransporte_4ta == "METRO" &
                                                                                  linea_metro_bajada_4 %in% c("L1", "L1-L3") & paraderobajada_4ta == "UNIVERSIDAD DE CHILE"), 
                                                      "UNIVERSIDAD DE CHILE L1"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                               which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L2", "L2-L3") & 
                                                                                                                       paraderobajada_4ta == "CAL Y CANTO"), "CAL Y CANTO L2"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                             which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L2", "L2-L6") & 
                                                                                                                                                                                                                     paraderobajada_4ta == "FRANKLIN"), "FRANKLIN L2"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                     which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L2", "L2-L4A") & 
                                                                                                                                                                                                                                                                                                             paraderobajada_4ta == "LA CISTERNA"), "LA CISTERNA L2"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L2", "L2-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                           paraderobajada_4ta == "LOS HEROES"), "LOS HEROES L2"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L2", "L2-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       paraderobajada_4ta == "SANTA ANA"), "SANTA ANA L2"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L4", "L4-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderobajada_4ta == "PLAZA EGANA"), "PLAZA EGANA L4"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L4", "L4-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               paraderobajada_4ta == "TOBALABA"), "TOBALABA L4"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L4", "L4-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       paraderobajada_4ta == "VICENTE VALDES"), "VICENTE VALDES L4"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L4", "L4-L4A") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           paraderobajada_4ta == "VICUNA MACKENNA"), "VICUNA MACKENNA L4"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L5", "L5-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 paraderobajada_4ta == "BAQUEDANO"), "BAQUEDANO L5"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           paraderobajada_4ta == "IRARRAZAVAL"), "IRARRAZAVAL L5"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L5", "L5-L6") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         paraderobajada_4ta == "NUBLE"), "NUBLE L5"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L5", "L5-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           paraderobajada_4ta == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L5"),paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L6", "L6-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              paraderobajada_4ta == "FRANKLIN"), "FRANKLIN L6"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L6", "L6-MT") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      paraderobajada_4ta == "LO VALLEDOR"), "LO VALLEDOR L6"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L6", "L6-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    paraderobajada_4ta == "NUBLE"), "NUBLE L6"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L6", "L6-L3") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      paraderobajada_4ta == "NUNOA"), "NUNOA L6"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L3", "L3-L2") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        paraderobajada_4ta == "CAL Y CANTO"), "CAL Y CANTO L3"),paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L3", "L3-L5") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     paraderobajada_4ta == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L3"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L3", "L3-L1") & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         paraderobajada_4ta == "UNIVERSIDAD DE CHILE"), "UNIVERSIDAD DE CHILE L3"), paraderobajada_4ta = 
                           replace(paraderobajada_4ta, which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% 
                                                               c("L3", "L3-L5") & paraderobajada_4ta == "IRARRAZAVAL"), "IRARRAZAVAL L3"), paraderobajada_4ta = 
                           replace(paraderobajada_4ta, which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% 
                                                               c("L3", "L3-L6") & paraderobajada_4ta == "NUNOA"), "NUNOA L3"), paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                                                                                                                            which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L3", "L3-L4") & 
                                                                                                                                                                    paraderobajada_4ta == "PLAZA EGANA"), "PLAZA EGANA L3"),
                         paraderosubida_1era = replace(paraderosubida_1era, 
                                                       which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L4A", "L4A-L4") & 
                                                               paraderosubida_1era == "LA CISTERNA"), "LA CISTERNA L4A"), paraderosubida_1era = replace(paraderosubida_1era, 
                                                                                                                                                        which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L4A", "L4A-L4") & 
                                                                                                                                                                paraderosubida_1era == "VICUNA MACKENNA"), "VICUNA MACKENNA L4A"),
                         paraderosubida_2da = replace(paraderosubida_2da, 
                                                      which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L4A", "L4A-L4") & 
                                                              paraderosubida_2da == "LA CISTERNA"), "LA CISTERNA L4A"), paraderosubida_2da = replace(paraderosubida_2da, 
                                                                                                                                                     which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L4A", "L4A-L4") & 
                                                                                                                                                             paraderosubida_2da == "VICUNA MACKENNA"), "VICUNA MACKENNA L4A"),
                         paraderosubida_3era = replace(paraderosubida_3era, which(tipotransporte_3era == "METRO" & 
                                                                                    linea_metro_subida_3 %in% c("L4A", "L4A-L4") & paraderosubida_3era == "LA CISTERNA"), 
                                                       "LA CISTERNA L4A"), paraderosubida_3era = replace(paraderosubida_3era, 
                                                                                                         which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L4A", "L4A-L4") & 
                                                                                                                 paraderosubida_3era == "VICUNA MACKENNA"), "VICUNA MACKENNA L4A"),
                         paraderosubida_4ta = replace(paraderosubida_4ta, which(tipotransporte_4ta == "METRO" & 
                                                                                  linea_metro_subida_4 %in% c("L4A", "L4A-L4") &  paraderosubida_4ta == "LA CISTERNA"), 
                                                      "LA CISTERNA L4A"), paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                                                                       which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L4A", "L4A-L4") & 
                                                                                                               paraderosubida_4ta == "VICUNA MACKENNA"), "VICUNA MACKENNA L4A"),
                         paraderobajada_1era = replace(paraderobajada_1era, which(tipotransporte_1era == "METRO" & 
                                                                                    linea_metro_bajada_1 %in% c("L4A", "L4A-L4") & paraderobajada_1era == "LA CISTERNA"), 
                                                       "LA CISTERNA L4A"), paraderobajada_1era = replace(paraderobajada_1era, 
                                                                                                         which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L4A", "L4A-L4") & 
                                                                                                                 paraderobajada_1era == "VICUNA MACKENNA"), "VICUNA MACKENNA L4A"),
                         paraderobajada_2da = replace(paraderobajada_2da, which(tipotransporte_2da == "METRO" & 
                                                                                  linea_metro_bajada_2 %in% c("L4A", "L4A-L4") & paraderobajada_2da == "LA CISTERNA"), 
                                                      "LA CISTERNA L4A"), paraderobajada_2da = replace(paraderobajada_2da, 
                                                                                                       which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L4A", "L4A-L4") & 
                                                                                                               paraderobajada_2da == "VICUNA MACKENNA"), "VICUNA MACKENNA L4A"),
                         paraderobajada_3era = replace(paraderobajada_3era, 
                                                       which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L4A", "L4A-L4") & 
                                                               paraderobajada_3era == "LA CISTERNA"), "LA CISTERNA L4A"), 
                         paraderobajada_3era = replace(paraderobajada_3era, which(tipotransporte_3era == "METRO" & 
                                                                                    linea_metro_subida_3 %in% c("L4A", "L4A-L4") &  paraderobajada_3era == "VICUNA MACKENNA"), 
                                                       "VICUNA MACKENNA L4A"),
                         paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                      which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L4A", "L4A-L4") & 
                                                              paraderobajada_4ta == "LA CISTERNA"), "LA CISTERNA L4A"), 
                         paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                      which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L4A", "L4A-L4") & 
                                                              paraderobajada_4ta == "VICUNA MACKENNA"), "VICUNA MACKENNA L4A"),
                         paraderosubida_1era = replace(paraderosubida_1era, 
                                                       which(tipotransporte_1era == "METRO" & linea_metro_subida_1 %in% c("L5", "L5-L4") & 
                                                               paraderosubida_1era == "VICENTE VALDES"), "VICENTE VALDES L5"),
                         paraderosubida_2da = replace(paraderosubida_2da, 
                                                      which(tipotransporte_2da == "METRO" & linea_metro_subida_2 %in% c("L5", "L5-L4") & 
                                                              paraderosubida_2da == "VICENTE VALDES"), "VICENTE VALDES L5"),
                         paraderosubida_3era = replace(paraderosubida_3era, 
                                                       which(tipotransporte_3era == "METRO" & linea_metro_subida_3 %in% c("L5", "L5-L4") & 
                                                               paraderosubida_3era == "VICENTE VALDES"), "VICENTE VALDES L5"),
                         paraderosubida_4ta = replace(paraderosubida_4ta, 
                                                      which(tipotransporte_4ta == "METRO" & linea_metro_subida_4 %in% c("L5", "L5-L4") & 
                                                              paraderosubida_4ta == "VICENTE VALDES"), "VICENTE VALDES L5"),
                         paraderobajada_1era = replace(paraderobajada_1era, 
                                                       which(tipotransporte_1era == "METRO" & linea_metro_bajada_1 %in% c("L5", "L5-L4") & 
                                                               paraderobajada_1era == "VICENTE VALDES"), "VICENTE VALDES L5"),
                         paraderobajada_2da = replace(paraderobajada_2da, 
                                                      which(tipotransporte_2da == "METRO" & linea_metro_bajada_2 %in% c("L5", "L5-L4") & 
                                                              paraderobajada_2da == "VICENTE VALDES"), "VICENTE VALDES L5"),
                         paraderobajada_3era = replace(paraderobajada_3era, 
                                                       which(tipotransporte_3era == "METRO" & linea_metro_bajada_3 %in% c("L5", "L5-L4") & 
                                                               paraderobajada_3era == "VICENTE VALDES"), "VICENTE VALDES L5"),
                         paraderobajada_4ta = replace(paraderobajada_4ta, 
                                                      which(tipotransporte_4ta == "METRO" & linea_metro_bajada_4 %in% c("L5", "L5-L4") & 
                                                              paraderobajada_4ta == "VICENTE VALDES"), "VICENTE VALDES L5"),
                         paraderobajada_1era = replace(paraderobajada_1era, which(tipotransporte_1era == "METRO" & 
                                                                                    linea_metro_bajada_1 %in% c("L1", "L1-L5") & paraderobajada_1era == "SAN PABLO"), "SAN PABLO L1"),
                         paraderobajada_1era = replace(paraderobajada_1era, which(tipotransporte_1era == "METRO" & 
                                                                                    linea_metro_bajada_1 %in% c("L4A", "L4A-L2") & paraderobajada_1era == "LA CISTERNA"), "LA CISTERNA L4A"),
                         paraderobajada_1era = replace(paraderobajada_1era, which(tipotransporte_1era == "METRO" & 
                                                                                    linea_metro_bajada_1 %in% c("L5", "L5-L1") & paraderobajada_1era == "SAN PABLO"), "SAN PABLO L5"),
                         paraderobajada_1era = replace(paraderobajada_1era, which(tipotransporte_1era == "METRO" & 
                                                                                    linea_metro_bajada_1 %in% c("L5", "L5-L2") & paraderobajada_1era == "SANTA ANA"), "SANTA ANA L5"),
                         paraderosubida_2da = replace(paraderosubida_2da, which(tipotransporte_2da == "METRO" & 
                                                                                  linea_metro_subida_2 %in% c("L5", "L5-L3") & paraderosubida_2da == "PLAZA DE ARMAS"), "PLAZA DE ARMAS L5"),
                         paraderobajada_3era = replace(paraderobajada_3era, which(tipotransporte_3era == "METRO" & 
                                                                                    linea_metro_bajada_3 %in% c("L1", "L1-L5") & paraderobajada_3era == "SAN PABLO"), "SAN PABLO L1"),
                         paraderobajada_3era = replace(paraderobajada_3era, which(tipotransporte_3era == "METRO" & 
                                                                                    linea_metro_bajada_3 %in% c("L4A", "L4A-L4") & paraderobajada_3era == "VICUNA MACKENNA"), "VICUNA MACKENNA L4A"),
                         paraderobajada_3era = replace(paraderobajada_3era, which(tipotransporte_3era == "METRO" & 
                                                                                    linea_metro_bajada_3 %in% c("L5", "L5-L1") & paraderobajada_3era == "SAN PABLO"), "SAN PABLO L5"),
                         paraderobajada_3era = replace(paraderobajada_3era, which(tipotransporte_3era == "METRO" & 
                                                                                    linea_metro_bajada_3 %in% c("L5", "L5-L2") & paraderobajada_3era == "SANTA ANA"), "SANTA ANA L5"),
                         paraderosubida = paraderosubida_1era,
                         netapa = replace(netapa, which(netapa > 4), 4)) %>% split(.$netapa)
  
  datos[[1]] <- mutate(.data = datos[[1]], paraderobajada = paraderobajada_1era)
  datos[[2]] <- mutate(.data = datos[[2]], paraderobajada = paraderobajada_2da)
  datos[[3]] <- mutate(.data = datos[[3]], paraderobajada = paraderobajada_3era)
  datos[[4]] <- mutate(.data = datos[[4]], paraderobajada = paraderobajada_4ta)
  
  datos <- dplyr::bind_rows(datos) %>%
    dplyr::mutate(serv_1era_etapacORR = if_else(condition = (tipotransporte_1era == 
                                                               "BUS" | tipotransporte_1era == "ZP"), true = serv_1era_etapa, false = 
                                                  if_else(condition = tipotransporte_1era == "METROTREN", true = 
                                                            tipotransporte_1era, false = linea_metro_subida_1, NA_character_))) %>% 
    mutate(serv_2da_etapacORR = if_else(condition = (tipotransporte_2da == "BUS" | 
                                                       tipotransporte_2da == "ZP"), true = serv_2da_etapa, false = if_else(condition = 
                                                                                                                             tipotransporte_2da == "METROTREN", true = tipotransporte_2da, false = 
                                                                                                                             linea_metro_subida_2, NA_character_))) %>% mutate(serv_3era_etapacORR = 
                                                                                                                                                                                 if_else(condition = (tipotransporte_3era == "BUS" | tipotransporte_3era == "ZP"), 
                                                                                                                                                                                         true = serv_3era_etapa, false = if_else(condition = tipotransporte_3era == 
                                                                                                                                                                                                                                   "METROTREN", true = tipotransporte_3era, false = linea_metro_subida_3, 
                                                                                                                                                                                                                                 NA_character_))) %>% mutate(serv_4ta_etapacORR = if_else(condition = 
                                                                                                                                                                                                                                                                                            (tipotransporte_4ta == "BUS" | tipotransporte_4ta == "ZP"), true = 
                                                                                                                                                                                                                                                                                            serv_4ta_etapa, false = if_else(condition = tipotransporte_4ta == 
                                                                                                                                                                                                                                                                                                                              "METROTREN", true = tipotransporte_4ta, false = linea_metro_subida_4, 
                                                                                                                                                                                                                                                                                                                            NA_character_))) %>% mutate(validacion = if_else(condition = 
                                                                                                                                                                                                                                                                                                                                                                               (netapa == 1 & serv_1era_etapacORR != "-" & paraderosubida_1era != "-" & 
                                                                                                                                                                                                                                                                                                                                                                                  paraderobajada_1era != "-") | (netapa == 2 & serv_1era_etapacORR != "-" & 
                                                                                                                                                                                                                                                                                                                                                                                                                   serv_2da_etapacORR != "-" & paraderosubida_1era != "-" & 
                                                                                                                                                                                                                                                                                                                                                                                                                   paraderobajada_1era != "-" & paraderosubida_2da != "-" & 
                                                                                                                                                                                                                                                                                                                                                                                                                   paraderobajada_2da != "-") | (netapa == 3 & serv_1era_etapacORR != "-" & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                   serv_2da_etapacORR != "-" & paraderosubida_1era != "-" & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                   paraderobajada_1era != "-" & paraderosubida_2da != "-" & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                   paraderobajada_2da != "-" & serv_3era_etapacORR != "-" & 
                                                                                                                                                                                                                                                                                                                                                                                                                                                   paraderosubida_3era != "-" & paraderobajada_3era != "-") | 
                                                                                                                                                                                                                                                                                                                                                                               (netapa == 4 & serv_1era_etapacORR != "-" & serv_2da_etapacORR != "-" & 
                                                                                                                                                                                                                                                                                                                                                                                  paraderosubida_1era != "-" & paraderobajada_1era != "-" & 
                                                                                                                                                                                                                                                                                                                                                                                  paraderosubida_2da != "-" & paraderobajada_2da != "-" & 
                                                                                                                                                                                                                                                                                                                                                                                  serv_3era_etapacORR != "-" & paraderosubida_3era != "-" & 
                                                                                                                                                                                                                                                                                                                                                                                  paraderobajada_3era != "-" & serv_4ta_etapacORR != "-" & 
                                                                                                                                                                                                                                                                                                                                                                                  paraderosubida_4ta != "-" & paraderobajada_4ta != "-"), true = 1, 
                                                                                                                                                                                                                                                                                                                                                                             false = 0, NA_real_)) %>% tidyr::unite(paraderosubida, 
                                                                                                                                                                                                                                                                                                                                                                                                                    paraderobajada, col = "OD", sep = "*", remove = F) %>% 
    dplyr::select(c(1:9,22:34))
  #travel status
  dat_stat <- sqldf::sqldf("SELECT SUM(Dda) AS DDA, paraderosubida, paraderobajada, validacion 
                           FROM datos GROUP BY  paraderosubida, paraderobajada, validacion;") %>%
    tidyr::spread(key = validacion, value = DDA) %>% mutate(`0`= if_else(condition = 
                                                                           is.na(`0`), true = 0, false = `0`, missing = NA_real_)) %>% mutate(`1`= 
                                                                                                                                                if_else(condition = is.na(`1`), true = 0, false = `1`, missing = NA_real_)) %>%
    mutate(factor = (`1` + `0`)/`1`) %>% mutate(Nva_OD = factor*`1`) %>% 
    tidyr::unite(paraderosubida, paraderobajada, col = "OD", sep = "*", remove = F)
  
  #fix travel demand
  datos <- mutate(.data = datos, factor = vlookup(lookup_value = OD, dict = dplyr::select(dat_stat, 
                                                                                          OD, factor), result_column = 2)) %>% mutate(DdaAjus = Dda*factor) %>% 
    mutate(interpar = if_else(paraderosubida == paraderobajada, true = 0, false = 1, 
                              missing = NA_real_)) %>% filter(validacion == 1, interpar == 1) 
  dat_O <- sum(datos$DdaAjus, na.rm = T) 
  print(paste(c("total original"),dat_O))
  datos <- dplyr::select(.data = datos, -c(1:2, 22,23,25)) %>% mutate(IDSub = vlookup(lookup_value = paraderosubida, dict =
                                                                                        dplyr::select(dicc_nd, CODTB9, IDNODORED), result_column = 2), IDBaj =
                                                                        vlookup(lookup_value = paraderobajada, dict = dplyr::select(dicc_nd, CODTB9, IDNODORED),
                                                                                result_column = 2)) %>% mutate(nodo = if_else(is.na(IDSub) | is.na(IDBaj), true = 0,
                                                                                                                              false = 1, missing = NA_real_)) %>% filter(nodo == 1)
  dat_d <- sum(datos$DdaAjus, na.rm = T)
  print(paste(c("total perdido"), dat_O*(1-dat_d/dat_O)))
  print(paste(c("% perdido"), (1-dat_d/dat_O)*100, c("%")))
  rm(dat_O, dat_d)
  #create matrix and write file
  dplyr::select(.data = datos, c(21:22,20)) %>% readr::write_delim(path =
                                                                     paste0("output viajes_etapas/viajes", per, ".csv"), na = "NA", delim = ";")
  #add SIMT, submode and write file
  datos <- dplyr::select(.data = datos, c(1:20)) %>% 
  mutate(submodo_1era = vlookup(lookup_value = 
                                  serv_1era_etapacORR, dict = dicc_m2, result_column = 2), submodo_2da =
           dplyr::if_else(condition = netapa >= 2, true =  vlookup(lookup_value =
                                                                     serv_2da_etapacORR, dict = dicc_m2, result_column = 2), false = "-",
                          missing = NA_character_), submodo_3era = dplyr::if_else(condition = netapa >= 3, true =
                                                                                    vlookup(lookup_value = serv_3era_etapacORR, dict = dicc_m2, result_column = 2), false = "-",
                                                                                  missing = NA_character_), submodo_4ta = dplyr::if_else(condition = netapa == 4, true =
                                                                                                                                           vlookup(lookup_value = serv_4ta_etapacORR, dict = dicc_m2, result_column = 2), false = "-",
                                                                                                                                         missing = NA_character_)) %>% 
    dplyr::rename(serv_1era = serv_1era_etapacORR, serv_2da = serv_2da_etapacORR,
                  serv_3era = serv_3era_etapacORR, serv_4ta = serv_4ta_etapacORR, Demanda = DdaAjus) %>% 
    dplyr::select(c(1:19, 21:24, 20)) %>%
    dplyr::mutate(periodo = per) %>% readr::write_delim(path = 
                                                               paste0("output viajes_etapas/baseviajes", per, ".csv"), na = "NA", delim = ";")
  datos
}

res_viajes <- viajes(query = query, dicc_nd = dicc_nodo, dicc_m2 = dicc_submodo, per = "PTA")
