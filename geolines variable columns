library(readxl)
library(dplyr)
library(tidyr)
input <- read_excel("Mov dic2015coor.xlsx", sheet = 2)
input$Tilan <- as.character(input$Tilan)
input$HoraRol <- as.character(input$HoraRol)
input <- input[!(input$ID %in% c(32,
                   75,
                   96,
                   120,
                   135,
                   136,
                   140,
                   141,
                   163,
                   164,
                   172,
                   209,
                   210,
                   220,
                   221,
                   263,
                   295,
                   330,
                   333,
                   343,
                   348,
                   429,
                   436,
                   447,
                   448,
                   452,
                   456,
                   457,
                   461,
                   462,
                   463,
                   496,
                   497,
                   598,
                   604,
                   624,
                   625,
                   678,
                   686,
                   687,
                   745,
                   746,
                   789,
                   790,
                   799,
                   855,
                   901,
                   902,
                   903,
                   1000,
                   1024,
                   1033,
                   1034,
                   1041,
                   1042,
                   1067,
                   1068,
                   1079,
                   1116,
                   1117,
                   1123,
                   1124,
                   1158,
                   1219,
                   1220,
                   1278,
                   1288,
                   1292,
                   1323,
                   1324,
                   1327,
                   1334,
                   1341,
                   1343,
                   1354,
                   1358,
                   1392,
                   1490,
                   1491,
                   1496,
                   1497,
                   1536,
                   1581,
                   1582,
                   1585,
                   1586,
                   1620,
                   1645,
                   1647,
                   1656,
                   1665,
                   1675,
                   1683,
                   1684,
                   1685,
                   1708,
                   1776,
                   1779,
                   1780,
                   1783,
                   1785,
                   1787,
                   1788,
                   1792,
                   1793,
                   1821,
                   1898,
                   1899,
                   1901,
                   1902,
                   1911,
                   1912,
                   1970,
                   1971,
                   1978,
                   1979,
                   2031,
                   2034,
                   2035,
                   2067,
                   2075,
                   2076,
                   2114,
                   2129,
                   2136,
                   2137,
                   2146,
                   2155,
                   2158,
                   2164,
                   2165,
                   2169,
                   2171,
                   2178,
                   2187,
                   2188,
                   2189,
                   2190,
                   2202,
                   2262,
                   2266,
                   2303,
                   2304,
                   2312,
                   2368,
                   2369,
                   2373,
                   2374,
                   2383,
                   2414,
                   2415,
                   2451,
                   2456,
                   2473,
                   2543,
                   2545,
                   2546,
                   2553,
                   2554,
                   2555,
                   2556,
                   2578,
                   2579,
                   2599,
                   2639,
                   2683,
                   2684,
                   2689,
                   2709,
                   2715,
                   2716,
                   2760,
                   2761,
                   2765,
                   2766,
                   2828,
                   2829,
                   2853,
                   2857,
                   2858,
                   2866,
                   2917,
                   2950,
                   2951,
                   2953,
                   2961,
                   2966,
                   2975,
                   2977,
                   2978,
                   2981,
                   3023,
                   3090,
                   3091,
                   3093,
                   3094,
                   3116,
                   3117,
                   3175,
                   3176,
                   3189,
                   3190,
                   3226,
                   3252,
                   3253,
                   3336,
                   3348,
                   3392,
                   3395,
                   3397,
                   3398,
                   3400,
                   3405,
                   3406,
                   3407,
                   3432,
                   3433,
                   3454,
                   3535,
                   3536,
                   3544,
                   3545,
                   3569,
                   3570,
                   3598,
                   3614,
                   3620,
                   3621,
                   3630,
                   3636,
                   3637,
                   3702,
                   3743,
                   3790,
                   3799,
                   3812,
                   3823,
                   3853,
                   3860,
                   3863,
                   3864,
                   3869,
                   3872,
                   3873,
                   3875,
                   3969,
                   3971,
                   3998,
                   3999,
                   4008,
                   4080,
                   4088,
                   4089,
                   4238,
                   4246,
                   4283,
                   4291,
                   4306,
                   4308,
                   4309,
                   4310,
                   4312,
                   4313,
                   4314,
                   4397,
                   4440,
                   4455,
                   4527,
                   4609,
                   4610,
                   4614,
                   4631,
                   4641,
                   4642,
                   4730,
                   4732,
                   4736,
                   4737,
                   4740,
                   4741,
                   4743,
                   4744,
                   4746,
                   4748,
                   4750,
                   4752,
                   4770,
                   4785,
                   4883,
                   4884,
                   4888,
                   4889,
                   4947,
                   4956,
                   4971,
                   4981,
                   5004,
                   5005,
                   5038,
                   5039,
                   5050,
                   5060,
                   5137,
                   5155,
                   5157,
                   5165,
                   5167,
                   5178,
                   5179,
                   5268,
                   5280,
                   5281,
                   5291,
                   5292,
                   5304,
                   5318,
                   5319,
                   5364,
                   5365,
                   5367,
                   5368,
                   5371,
                   5404,
                   5417,
                   5456,
                   5457,
                   5483,
                   5490,
                   5491,
                   5542,
                   5543,
                   5548,
                   5554,
                   5555,
                   5556,
                   5559,
                   5597,
                   5610,
                   5611,
                   5619,
                   5672,
                   5711,
                   5714,
                   5715,
                   5744,
                   5745,
                   5782,
                   5806,
                   5813,
                   5893,
                   5925,
                   5926,
                   5961,
                   5980,
                   5983,
                   6022,
                   6027,
                   6033,
                   6034,
                   6036,
                   6041,
                   6042,
                   6048,
                   6049,
                   6053,
                   6057,
                   6058,
                   6059,
                   6060,
                   6138,
                   6159,
                   6200,
                   6201,
                   6204,
                   6205,
                   6229,
                   6230,
                   6277,
                   6278,
                   6289,
                   6319,
                   6345,
                   6364,
                   6395,
                   6398,
                   6399,
                   6406,
                   6488,
                   6500,
                   6512,
                   6518,
                   6522,
                   6523,
                   6526,
                   6529,
                   6530,
                   6670,
                   6671,
                   6682,
                   6683,
                   6748,
                   6749,
                   6756,
                   6757,
                   6863,
                   6865,
                   6886,
                   6928,
                   6932,
                   6935,
                   6955,
                   6959,
                   6962,
                   6963,
                   6978,
                   6997,
                   6999,
                   7001,
                   7002,
                   7005,
                   7054,
                   7098,
                   7099,
                   7107,
                   7110,
                   7182,
                   7183,
                   7248,
                   7253,
                   7254,
                   7270,
                   7271,
                   7303,
                   7312,
                   7317,
                   7351,
                   7352,
                   7353,
                   7360,
                   7363,
                   7365,
                   7371,
                   7372,
                   7374,
                   7375,
                   7379,
                   7382,
                   7383,
                   7384,
                   7386,
                   7388,
                   7398,
                   7399,
                   7402,
                   7408,
                   7409,
                   7410,
                   7417,
                   7444,
                   7472,
                   7480,
                   7520,
                   7521,
                   7525,
                   7526,
                   7573,
                   7600,
                   7601,
                   7606,
                   7607,
                   7619,
                   7642,
                   7669,
                   7670,
                   7701,
                   7702,
                   7703,
                   7716,
                   7739,
                   7752,
                   7754,
                   7777,
                   7783,
                   7784,
                   7791,
                   7794,
                   7795,
                   7809,
                   7810,
                   7811,
                   7812,
                   7814,
                   7815,
                   7816,
                   7833,
                   7839,
                   7840,
                   7891,
                   7892,
                   7918,
                   7979,
                   7990,
                   7993,
                   8013,
                   8014,
                   8034,
                   8035,
                   8058,
                   8059,
                   8114,
                   8115,
                   8154,
                   8162,
                   8203,
                   8205,
                   8211,
                   8214,
                   8216,
                   8223,
                   8224,
                   8226,
                   8229,
                   8230,
                   8234,
                   8235,
                   8242,
                   8243,
                   8309,
                   8326,
                   8333,
                   8334,
                   8338,
                   8339,
                   8383,
                   8400,
                   8406,
                   8407,
                   8409,
                   8410,
                   8415,
                   8424,
                   8433,
                   8437,
                   8442,
                   8443,
                   8457,
                   8458,
                   8495,
                   8516,
                   8531,
                   8562,
                   8576,
                   8581,
                   8595,
                   8598,
                   8601,
                   8606,
                   8619,
                   8620,
                   8623,
                   8624,
                   8625,
                   8627,
                   8673,
                   8674,
                   8689,
                   8700,
                   8705,
                   8770,
                   8771,
                   8777,
                   8800,
                   8801,
                   8856,
                   8857,
                   8863,
                   8864,
                   8927,
                   8969,
                   8976,
                   8978,
                   9004,
                   9071,
                   9083,
                   9098,
                   9100,
                   9110,
                   9117,
                   9119,
                   9120,
                   9121,
                   9122,
                   9149,
                   9150,
                   9198,
                   9199,
                   9257,
                   9311,
                   9312,
                   9321,
                   9341,
                   9342,
                   9366,
                   9424,
                   9519,
                   9537,
                   9569,
                   9570,
                   9572,
                   9576,
                   9582,
                   9584,
                   9589,
                   9591,
                   9593,
                   9596,
                   9600,
                   9604,
                   9635,
                   9695,
                   9701,
                   9715,
                   9735,
                   9752,
                   9755,
                   9819,
                   9868,
                   9907,
                   9908,
                   9935,
                   9941,
                   9942,
                   9971,
                   9983,
                   9987,
                   9997,
                   10005,
                   10033,
                   10037,
                   10039,
                   10048,
                   10051,
                   10057,
                   10062,
                   10064,
                   10067,
                   10138,
                   10161,
                   10180,
                   10181,
                   10182,
                   10183,
                   10200,
                   10208,
                   10236,
                   10237,
                   10254,
                   10255,
                   10336,
                   10337,
                   10377,
                   10378,
                   10390,
                   10432,
                   10484,
                   10486,
                   10487,
                   10490,
                   10491,
                   10493,
                   10495,
                   10496,
                   10504,
                   10505,
                   10556,
                   10568,
                   10598,
                   10604,
                   10605,
                   10606,
                   10617,
                   10618,
                   10632,
                   10665,
                   10667,
                   10668,
                   10706,
                   10707,
                   10731,
                   10732,
                   10747,
                   10789,
                   10801,
                   10802,
                   10805,
                   10807,
                   10826,
                   10827,
                   10876,
                   10899,
                   10900,
                   10901,
                   10902,
                   10961,
                   10962,
                   10963,
                   10964,
                   10997,
                   11013,
                   11035,
                   11036,
                   11044,
                   11076,
                   11117,
                   11124,
                   11131,
                   11132,
                   11204,
                   11238,
                   11239,
                   11248,
                   11261,
                   11262,
                   11263,
                   11291,
                   11323,
                   11324,
                   11328,
                   11329,
                   11330,
                   11343,
                   11377,
                   11378,
                   11398,
                   11407,
                   11414,
                   11415,
                   11432,
                   11475,
                   11539,
                   11540,
                   11546,
                   11660,
                   11661,
                   11665,
                   11666,
                   11676,
                   11682,
                   11683,
                   11698,
                   11710,
                   11724,
                   11743,
                   11744,
                   11753,
                   11759,
                   11760,
                   11793,
                   11817,
                   11839,
                   11840,
                   11848,
                   11871,
                   11877,
                   11878,
                   11940,
                   11953,
                   11964,
                   11980,
                   11988,
                   11989,
                   11990,
                   11992,
                   11997,
                   11999,
                   12004,
                   12005,
                   12006,
                   12007,
                   12067,
                   12108,
                   12109,
                   12110,
                   12111,
                   12121,
                   12132,
                   12133,
                   12178,
                   12186,
                   12187,
                   12192,
                   12198,
                   12199,
                   12200,
                   12204,
                   12258,
                   12291,
                   12324,
                   12382,
                   12397,
                   12402,
                   12405,
                   12406,
                   12411,
                   12412,
                   12416,
                   12517,
                   12536,
                   12556,
                   12604,
                   12610,
                   12682,
                   12717,
                   12769,
                   12786,
                   12809,
                   12822,
                   12827,
                   12833,
                   12844,
                   12847,
                   12870,
                   12889,
                   12905,
                   12948,
                   12949,
                   12950,
                   12971,
                   13008,
                   13012,
                   13019,
                   13020,
                   13032,
                   13061,
                   13091,
                   13092,
                   13111,
                   13112,
                   13116,
                   13126,
                   13127,
                   13129,
                   13134,
                   13156,
                   13157,
                   13172,
                   13173,
                   13190,
                   13217,
                   13223)), ]
input$HoraRol2 <- substr(input$HoraRol,start = 12, stop = 19)
input$HoraRec2 <- substr(input$HoraRec,start = 12, stop = 19)
input$FechaHoraRol <- strptime(paste(as.character(input$FechaMovimiento), 
                                     input$HoraRol2, sep = " "), "%Y-%m-%d %H:%M:%S")
input$FechaHoraRec <- strptime(paste(as.character(input$FechaMovimiento), 
                                     input$HoraRec2, sep = " "), "%Y-%m-%d %H:%M:%S")
input <- input[order(input$HoraRec2),]


coord.input <- input[c("ID","latitude","longitude")]
coord.input$coor <- paste(input$x, ",", input$y) 
coord.input <- coord.input[c("ID", "coor")]
coord.input <- coord.input %>% group_by(ID) %>% mutate(idx = row_number()) %>% spread(idx, coor)
coord.input <- coord.input[1:nrow(coord.input)-1,]
numnAs <- as.data.frame(ncol(coord.input) - 1 - apply(coord.input, 1, function(z) sum(is.na(z))))
numnAs$ID2 <- row.names(numnAs)
coord.input$ID2 <- row.names(coord.input)
coord.input <- left_join(x = coord.input,y = numnAs,"ID2")
names(coord.input) <- c("ID", "1", "2", "3", "4", "5", "6", "ID2", "ncoor")
coord.input <- coord.input[c("ID2", "ncoor", "1", "2", "3", "4", "5", "6")]
geolineas <- sapply(as.list(as.data.frame(t(coord.input))), function(x) {paste(na.omit(x), collapse=",")})
write.table(x = geolineas, file = "geolineas.geo", col.names = F, row.names = F, quote = F)
